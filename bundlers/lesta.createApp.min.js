(()=>{var Y=Object.defineProperty;var Z=(a,t)=>{for(var e in t)Y(a,e,{get:t[e],enumerable:!0})};function u(a){return a?typeof a=="object"?JSON.parse(JSON.stringify(a)):a:a??null}function b(a,t){let e=new WeakMap;function o(n){return{getPrototypeOf(c){return{target:c,instance:"Proxy"}},set(c,h,p,w){let{path:B,ref:X}=s(n,h),C=!1;return t.beforeSet(p,X,()=>{if(c[h]!=null&&typeof c[h]=="object"){if(c[h]===p&&(C=!0),Reflect.has(c,h)&&r(c,h),p!=null&&typeof p=="object"){let S=JSON.stringify(p);S!==JSON.stringify(c[h])?p=JSON.parse(S):C=!0}}else Object.is(c[h],p)&&h!=="length"&&(C=!0)},S=>{p=u(S)}),C||(p!=null&&typeof p=="object"&&!e.has(p)&&(p=i(p,B)),Reflect.set(c,h,p,w),t.set&&t.set(c,B,p,X)),!0},get(c,h,p){if(t.get){if(h===Symbol.toPrimitive)return;let{ref:w}=s(n,h);t.get(c,w)}return Reflect.get(c,h,p)},deleteProperty(c,h){return Reflect.has(c,h)?(r(c,h),Reflect.deleteProperty(c,h)):!1}}}function s(n,c){let h=[...n,c],p=h.join(".");return{path:h,ref:p}}function r(n,c){e.has(n[c])&&e.delete(n[c]);for(let h of Object.keys(n[c]))n[c][h]!=null&&typeof n[c][h]=="object"&&r(n[c],h)}function i(n,c){for(let p of Object.keys(n))n[p]!=null&&typeof n[p]=="object"&&(n[p]=i(n[p],[...c,p]));let h=new Proxy(n,o(c));return e.set(h,n),h}return i(a,[])}function f(a,t,e,o){let s=(r,i)=>{let n=r.split("."),c=i.split(".");for(let h=0;h<c.length;h++)if(n[h]!==c[h])return!1;return!0};for(let[r,i]of a)if(Array.isArray(i))i.includes(t)&&r(e);else if(s(t,i)){let n=[...o];n.shift(),r(e,n)}}function H(a,t,e){let o;for(o=0;o<t.length-1;o++)a=a[t[o]];a[t[o]]=e}async function x(a){if(typeof a=="function"){let t=a();return t instanceof Promise?(await t)?.default:void 0}return a}function T(a,t){for(let[e,o]of a)if(Array.isArray(o)){let s=o.indexOf(t);s!==-1&&(o.length===1?a.delete(e):o.splice(s,1))}else o===t&&a.delete(e)}function v(a){return new DOMParser().parseFromString(a,"text/html").body||document.createElement("body")}function q(a){function t(i){let n=i.querySelectorAll("script");for(let c of n)c.remove()}function e(i,n){let c=n.replace(/\s+/g,"").toLowerCase();if(["src","href","xlink:href"].includes(i)&&(c.includes("javascript:")||c.includes("data:text/html"))||i.startsWith("on"))return!0}function o(i){let n=i.attributes;for(let{name:c,value:h}of n)e(c,h)&&i.removeAttribute(c)}function s(i){let n=i.children;for(let c of n)o(c),s(c)}let r=v(a);return t(r),s(r),r.childNodes}var N=()=>{let a=[],t=!1,e=()=>a.length,o=()=>a.length===0,s=i=>{a.push(i),t||(t=!0,r())},r=async()=>{let i=a.at(0);i?(await i(),a.shift(),r()):t=!1};return{add:s,isEmpty:o,size:e}};async function U(a,t,e){await a.loaded(t),e&&await a.props(e,t),a.params(),a.methods(t),a.proxies(),await a.created(),await a.nodes(t),await a.mounted()}var _={update:(a,t)=>{let e=typeof t=="function"?t(a):t;a.innerHTML="",a.append(...q(e))}};var D={update:(a,t)=>{let e=typeof t=="function"?t(a):t;a.innerHTML=e}};var I={update:(a,t,e)=>{(typeof t[e]=="function"?t[e](a):t[e])?a.classList.add(e):a.classList.remove(e)}};var E=class{constructor(t,e,o){this.Nodes=o,this.component=t,this.app=e,this.proxiesData={},this.impress={refs:[],collect:!1,exclude(s){this.collect=!1;let r=s();return this.collect=!0,r},define(s){return s&&s.startsWith("_")?this.refs[0]:[...this.refs]},clear(){this.collect=!1,this.refs.length=0}},this.context={exclude:this.impress.exclude.bind(this.impress),container:null,options:t,node:{},param:{},method:{},proxy:{},source:t.sources,directives:{_html:_,_evalHTML:D,_class:I},router:e.router||{},component:e.components||{},root:e.root},Object.preventExtensions(this.context.source),Object.assign(this.context,e.common||{}),Object.assign(this.context.directives,t.directives||{},e.directives||{})}async loaded(t){this.context.container=t,this.component.loaded&&await this.component.loaded.bind(this.context)()}async created(){this.component.created&&await this.component.created.bind(this.context)()}async mounted(){this.component.mounted&&await this.component.mounted.bind(this.context)()}methods(t){if(t.method||(t.method={}),this.component.methods)for(let[e,o]of Object.entries(this.component.methods))this.context.method[e]=o.bind(this.context),t.method[e]=(...s)=>this.context.method[e](...u(s));Object.preventExtensions(this.context.method)}params(){if(this.component.params)for(let t in this.component.params){if(t in this.context.param)return this.app.errorComponent(container.nodepath,213,t);this.context.param[t]=this.component.params[t]}Object.preventExtensions(this.context.param)}proxies(){if(this.component.proxies)for(let t in this.component.proxies){if(t in this.proxiesData)return this.app.errorComponent(container.nodepath,214,t);this.proxiesData[t]=this.component.proxies[t]}this.context.proxy=b(this.proxiesData,{beforeSet:(t,e,o,s)=>{if(!this.component.setters||!this.component.setters[e])o();else{let r=this.component.setters[e].bind(this.context)(t);s(r)}},set:(t,e,o,s)=>{for(let r in this.context.node){let i=this.context.node[r];i.reactivity.node&&f(i.reactivity.node,s),i.reactivity.component&&f(i.reactivity.component,s,o,e);for(let n in i.section)i.section[n]?.reactivity.component&&f(i.section[n].reactivity.component,s,o,e)}this.component.handlers&&this.component.handlers[s]?.bind(this.context)(o)},get:(t,e)=>{this.impress.collect&&!this.impress.refs.includes(e)&&this.impress.refs.push(e)}}),Object.preventExtensions(this.context.proxy)}async nodes(t){if(this.component.nodes){let e=this.component.nodes.bind(this.context)();for await(let[o,s]of Object.entries(e)){let r=this.component.selectors&&this.component.selectors[o]||`.${o}`,i=t.querySelector(r)||t.classList.contains(o)&&t;if(!i)return this.app.errorNode(o,105);if(i.nodepath=t.nodepath?t.nodepath+"."+o:o,i.nodename=o,Object.assign(this.context.node,{[o]:i}),s){let n=new this.Nodes(s,this.context,i,this.impress,this.app,o);for await(let[c]of Object.entries(s))await n.controller(c)}}Object.preventExtensions(this.context.node)}}};var M=class extends E{constructor(...t){super(...t)}async destroy(t){t.reactivity&&t.reactivity.component.clear(),t.proxy={},t.method={};for(let e in t.unstore)t.unstore[e]();delete t.unmount}async unmount(){if(this.context.node)for await(let t of Object.values(this.context.node)){if(t.unmount&&!t.hasAttribute("iterable")){if(t.section)for await(let e of Object.values(t.section))await e.unmount&&e.unmount();await t.unmount()}if(t.directives)for await(let e of Object.values(t.directives))e.destroy&&e.destroy();t.reactivity&&t.reactivity.node.clear()}this.component.unmount&&await this.component.unmount.bind(this.context)()}async props(t,e){if(t.proxies&&Object.keys(t.proxies).length&&!this.component.props?.proxies)return this.app.errorComponent(e.nodepath,211);if(e.proxy||(e.proxy={}),this.component.props){if(this.component.props.proxies){for(let o in t.proxies)if(!(o in this.component.props.proxies))return this.app.errorProps(e.nodepath,"proxies",o,301);for(let o in this.component.props.proxies){let s=this.component.props.proxies[o];if(typeof s!="object")return this.app.errorProps(e.nodepath,"proxies",o,302);let r=c=>{s.required&&c==null&&this.app.errorProps(e.nodepath,"proxies",o,303);let h=c??s.default??null;return s.type&&typeof h!==s.type&&this.app.errorProps(e.nodepath,"proxies",o,304,s.type),h};e.proxy[o]=(c,h)=>{h&&h.length!==0?H(this.context.proxy[o],h,c):this.context.proxy[o]=r(c)};let i=null,{store:n}=s;t.proxies&&o in t.proxies?i=t.proxies[o]:n&&(await this.app.checkStore(n),e.destorey||(e.unstore={}),e.unstore[o]=()=>{},i=this.app.store[n].proxies(o,e)),this.proxiesData[o]=u(r(i))}}for(let o in this.component.props.methods){let s=this.component.props.methods[o];if(typeof s!="object")return this.app.errorProps(e.nodepath,"methods",o,302);let{store:r}=s;if(r){await this.app.checkStore(r);let i=this.app.store[r].methods(o);if(!i)return this.app.errorProps(e.nodepath,"methods",o,305,r);this.context.method[o]=(...n)=>i(...u(n))}else{let i=t.methods&&o in t.methods;if(s.required&&!i)return this.app.errorProps(e.nodepath,"methods",o,303);i&&(this.context.method[o]=(...n)=>t.methods[o](...u(n)))}}for(let o in this.component.props.params){let s=this.component.props.params[o];if(typeof s!="object")return this.app.errorProps(e.path,"params",o,302);let{store:r}=s,i=t?.params[o];if(r){await this.app.checkStore(r);let n=this.app.store[r].params(o);this.context.param[o]=u(n)??(s.required&&this.app.errorProps(e.path,"params",o,303)||s.default)}else{let n=i instanceof Promise||i instanceof HTMLCollection||i instanceof NodeList||i instanceof Element||o.startsWith("__");this.context.param[o]=n?i:u(i)??(s.required&&this.app.errorProps(e.path,"params",o,303)||s.default)}s.type&&typeof this.context.param[o]!==s.type&&this.app.errorProps(e.path,"params",o,304,s.type),s.readonly&&Object.defineProperty(this.context.param,o,{writable:!1})}}}};var W={};Z(W,{errorComponent:()=>A,errorNode:()=>V,errorProps:()=>Q,errorRouter:()=>z,errorStore:()=>l,warnRouter:()=>J});var rt={102:'incorrect directive name "%s", the name must start with the character "_".',103:'node property "%s" expects an object as its value.',104:'unknown node property: "%s".',105:"node with this name was not found in the template.",106:"innerHTML method is not secure due to XXS attacks, use _html or _evalHTML directives."},V=(a,t,e="")=>console.error(`[Lesta error ${t}]: Error in node "${a}": ${rt[t]}`,e);var nt={201:'section "%s" found in component template.',202:'section not defined "%s".',203:"src property must not be empty.",204:"the iterate property is not supported for sections.",205:"the iterate property expects a function.",206:"the iterate function must return an array.",207:"node is a section, component property is not supported.",208:"node is iterable, component property is not supported.",209:"the iterable component must have a template.",210:"an iterable component must have only one root tag in the template.",211:"parent component passes proxies, you need to accept them in props.",212:'the "induce" property expects a function.',213:'param "%s" is already in props.',214:'proxy "%s" is already in props.'},A=(a="root",t,e="")=>console.error(`[Lesta error ${t}]: Error creating component "${a}": ${nt[t]}`,e);var at={301:"parent component passes proxies, you need to accept them in props.",302:"waiting for an object.",303:"props is required.",304:'value does not match type "%s".',305:'method not found in store "%s".'},Q=(a="root",t,e,o,s="")=>console.error(`[Lesta error ${o}]: Error in props ${t} "${e}" in component "${a}": ${at[o]}`,s);var ct={401:"store not found.",402:"loading error from sources.",403:"store methods can take only one argument of type object.",404:'middleware "%s" can take only one argument of type object.'},l=(a,t,e="")=>console.error(`[Lesta error ${t}]: Error in store "${a}": ${ct[t]}`,e);var G={501:"path not found in route.",502:"path not found in child route.",551:'name "%s" not found in routes.',552:"current route has no parameters.",553:'param "%s" not found in current route.',554:'param "%s" not found in object route.',555:'param "%s" does not match regular expression.',556:"too many redirects",557:'property "path" missing'},z=(a="",t,e="")=>console.error(`[Lesta error ${t}]: Error in route "${a}": ${G[t]}`,e),J=(a,t="")=>console.error(`[Lesta warn ${a}]: ${G[a]}`,t);var m=class{constructor(t,e,o,s,r,i){this.app=r,this.node=t,this.context=e,this.impress=s,this.nodeElement=o,this.keyNode=i,this.nodeElement.reactivity={node:new Map}}reactive(t,e,o){t.length&&o.set(e,t),this.impress.clear()}reactiveNode(t,e){this.reactive(t,e,this.nodeElement.reactivity.node)}};var $=class{constructor(t,e,o,s){if(this.app=e,this.name=o,this.nodeElement=s,this.component=t,!this.component.src)return this.app.errorComponent(s.nodepath,203)}async props(t,e,o){let s={};return t&&(s.proxies=t),s.params=this.params(this.component.params,e,o),s.methods=this.methods(this.component.methods),s.section=this.component.section,s.name=this.name,s}methods(t){let e={};if(t)for(let[o,s]of Object.entries(t))typeof s=="function"&&Object.assign(e,{[o]:s});return e}params(t,e,o){let s={};if(t)for(let[r,i]of Object.entries(t)){let n=null;typeof i=="function"&&i.name?n=e?i(e,o):i(this.nodeElement):n=i,Object.assign(s,{[r]:n})}return s}async create(t,e,o,s){if(t){let r=await this.props(e,o,s),i=await x(t);return await this.app.mount(i,r,this.nodeElement)}}};var d=class extends m{constructor(...t){super(...t),this.nodeElement.reactivity.component=new Map}reactiveComponent(t,e,o){let s=o||this.nodeElement;this.reactive(t,e,s.reactivity.component)}reactivate(t,e,o,s,r){let i={};if(t)for(let[n,c]of Object.entries(t))if(typeof c=="function"&&c.name){this.impress.collect=!0;let h=o&&c.length?c(o[s],s):c(r);Object.assign(i,{[n]:h}),e(n,c),this.impress.clear()}else Object.assign(i,{[n]:c});return i}async section(t,e,o){let s=async(r,i)=>{e.setAttribute("integrate",""),e.section[r].unmount&&await this.nodeElement.section[r].unmount(),i.section=r,await this.create(t,e,i,o(i.proxies,e.section[i.section],i.section))};if(e.section={},this.node.component.sections)for await(let[r,i]of Object.entries(this.node.component.sections)){let n=e.querySelector(`[section="${r}"]`);if(!n)return this.app.errorComponent(e.nodepath,201,r);if(n.reactivity||(n.reactivity={component:new Map}),Object.assign(e.section,{[r]:n}),i.src)await s(r,i);else if(this.node.component.iterate)return this.app.errorComponent(n.nodepath,204);e.integrate=s}}async create(t,e,o,s,r,i){let c=await new $(o,this.app,this.keyNode,e).create(o.src,s,r,i);o.sections&&await this.section(t,c?.container,(h,p,w)=>i!==void 0?t(h,c?.container.section[w],i):t(h,p))}};var g=class extends d{constructor(...t){super(...t),this.queue=N(),this.name=null,this.created=!1}async init(){if(typeof this.node.component.iterate!="function")return this.app.errorComponent(this.nodeElement.nodepath,205);if(this.createIterate=async t=>{let e=this.proxies(this.node.component.proxies,this.nodeElement.children[t],t);await this.create(this.proxies.bind(this),this.nodeElement,this.node.component,e,this.data[t],t),this.created=!0},this.impress.collect=!0,this.data=this.node.component.iterate(),!Array.isArray(this.data))return this.app.errorComponent(this.nodeElement.nodepath,206);this.name=this.impress.refs[0],this.impress.clear(),this.nodeElement.setAttribute("iterate",""),Object.getPrototypeOf(this.data).instance==="Proxy"&&(this.reactiveComponent([this.name],async t=>{this.data=this.node.component.iterate(),t.length&&this.queue.add(async()=>{if(this.node.component.proxies){for(let[e,o]of Object.entries(this.node.component.proxies))if(typeof o=="function"&&o.name&&o.length)for(let s=0;s<Math.min(this.nodeElement.children.length,t.length);s++){let r=o(this.data[s],s);this.nodeElement.children[s].proxy[e](r),this.sections(this.node.component.sections,this.nodeElement.children[s],s)}}}),this.queue.add(async()=>await this.length(t.length))}),this.reactiveComponent([this.name+".length"],async t=>{this.queue.add(async()=>await this.length(t))}));for await(let[t]of this.data.entries())await this.createIterate(t);return this.createIterate}sections(t,e,o){if(t)for(let[s,r]of Object.entries(t))for(let[i,n]of Object.entries(r.proxies))typeof n=="function"&&n.name&&n.length&&(e.section[s]?.proxy[i](n(this.data[o],o)),this.sections(r.sections,e.section[s],o))}proxies(t,e,o){let s=(r,i)=>{this.impress.refs.some(n=>n.includes(this.name))?this.reactiveComponent(this.impress.define(r),async(n,c)=>{this.queue.add(async()=>{if(c)c.shift(),this.nodeElement.children[o]?.proxy[r](n,c);else if(this.data=this.node.component.iterate(),o<this.data.length){let h=i(this.data[o],o);this.nodeElement.children[o]?.proxy[r](h)}})},e):this.created?this.impress.clear():this.reactiveComponent(this.impress.define(r),async(n,c)=>{this.queue.add(async()=>{for(let h=0;h<this.nodeElement.children.length;h++)c?this.nodeElement.children[h].proxy[r](n,c):this.nodeElement.children[h].proxy[r](i())})},e)};return this.reactivate(t,s,this.data,o)}async length(t){this.data.length===t&&(t>this.nodeElement.children.length&&await this.add(t),t<this.nodeElement.children.length&&await this.remove(t))}async add(t){let e=this.nodeElement.children.length;for(;t>e;)await this.createIterate(e),e++}async remove(t){let e=this.nodeElement.children.length;for(;t<e;)e--,T(this.nodeElement.reactivity.component,this.name+"."+e),await this.nodeElement.children[e].unmount()}};var O=class extends d{constructor(...t){super(...t)}async init(){let t=()=>this.create(this.proxies.bind(this),this.nodeElement,this.node.component,this.proxies(this.node.component.proxies,this.nodeElement));if(this.nodeElement.refresh=async()=>{this.nodeElement.unmount&&await this.nodeElement.unmount(),await t()},this.node.component.induce){if(typeof this.node.component.induce!="function")return this.app.errorComponent(this.nodeElement.nodepath,212);this.impress.collect=!0;let e=this.node.component.induce(),o=async()=>{await t(),this.nodeElement.setAttribute("induced","")};this.reactiveNode(this.impress.define(),async()=>{let s=this.node.component.induce();this.nodeElement.hasAttribute("induced")?s||(await this.nodeElement.unmount(),this.nodeElement.removeAttribute("induced")):s&&await o()}),e&&await o()}else await t()}proxies(t,e){let o=(s,r)=>this.reactiveComponent(this.impress.define(s),(i,n)=>{e.proxy&&e.proxy[s]&&(n?e.proxy[s](i,n):e.proxy[s](r(this.nodeElement)))},e);return this.reactivate(t,o,null,null,e)}};var j=class extends m{constructor(...t){super(...t)}init(t){if(t[0]!=="_")return this.app.errorNode(this.nodeElement.nodepath,102,t);let e=this.context.directives[t],o=this.node[t],{create:s,update:r,destroy:i}=e;"directives"in this.nodeElement||Object.assign(this.nodeElement,{directives:{}}),Object.assign(this.nodeElement.directives,{[t]:{create:()=>s?s(this.nodeElement,o,e):{},destroy:()=>i?i(this.nodeElement,o,e):{}}}),s&&this.nodeElement.directives[t].create();let n=(c,h,p)=>{typeof c=="function"?(this.impress.collect=!0,r.bind(e)(this.nodeElement,h,p),this.reactiveNode(this.impress.define(),()=>r(this.nodeElement,h,p))):r.bind(e)(this.nodeElement,h,p)};if(r!=null)if(typeof o=="object")for(let c in o)n(o[c],o,c);else n(o,o)}};var L=class extends m{constructor(...t){super(...t)}listeners(t){typeof this.node[t]=="function"&&(this.nodeElement[t]=e=>this.node[t].bind(this.context)(e))}general(t){if(t==="innerHTML")return this.app.errorNode(this.nodeElement.nodepath,106);if(typeof this.node[t]=="function"){let e=()=>{let o=this.node[t].bind(this.context)(this.nodeElement);this.nodeElement[t]!==null&&typeof this.nodeElement[t]=="object"?o!==null&&typeof o=="object"?Object.assign(this.nodeElement[t],o):this.app.errorNode(this.nodeElement.nodepath,103,t):this.nodeElement[t]=o!==Object(o)?o:JSON.stringify(o)};this.impress.collect=!0,e(),this.reactiveNode(this.impress.define(),e)}else this.nodeElement[t]=this.node[t]}init(t){t.substr(0,2)==="on"?this.listeners(t):this.general(t)}};var y=class{constructor(t,e,o,s,r,i){this.app=r,this.node=t,this.context=e,this.impress=s,this.nodeElement=o,this.keyNode=i,this.directive=new j(t,e,o,s,r,i),this.native=new L(t,e,o,s,r,i)}async controller(t){t in this.nodeElement?this.native.init(t):t in this.context.directives?this.directive.init(t):t==="component"&&this.component?await this.component():this.app.errorNode(this.nodeElement.nodepath,104,t)}};var P=class extends y{constructor(...t){super(...t);let{node:e,context:o,nodeElement:s,impress:r,app:i,keyNode:n}=this;this.basic=new O(e,o,s,r,i,n),this.iterate=new g(e,o,s,r,i,n)}async component(){if(this.nodeElement.hasAttribute("section"))return this.app.errorComponent(this.nodeElement.nodepath,207);if(this.nodeElement.hasAttribute("iterable"))return this.app.errorComponent(this.nodeElement.nodepath,208);this.node.component.iterate?await this.iterate.init():await this.basic.init()}};var R=class{constructor(t,e,o){this.store=t,this.context={name:o,reactivity:new Map,param:{},method:{},router:e.router||{},source:this.store.sources},Object.assign(this.context,e.common),this.context.param=this.store.params,Object.preventExtensions(this.context.param);for(let s in this.store.methods)this.context.method[s]=(...r)=>{if(r.length&&(r.length>1||typeof r[0]!="object"))return l(this.context.name,404,s);let i={...u(r[0])};return this.store.middlewares&&s in this.store.middlewares?(async()=>{let n=await this.store.middlewares[s].bind(this.context)(i);return n&&typeof n!="object"?l(this.context.name,404,s):(i&&n&&Object.assign(i,n),this.store.methods[s].bind(this.context)(i))})():this.store.methods[s].bind(this.context)(i)};this.context.proxy=b(this.store.proxies,{beforeSet:(s,r,i,n)=>{if(!this.store.setters||!this.store.setters[r])i();else{let c=this.store.setters[r].bind(this.context)(s);n(c)}},set:async(s,r,i,n)=>{f(this.context.reactivity,n,i,r)}}),Object.preventExtensions(this.context.proxy)}created(){this.store.created&&this.store.created.bind(this.context)()}params(t){return this.context.param[t]}proxies(t,e){let o=(s,r)=>e.proxy[t](s,r);return this.context.reactivity.set(o,t),e.unstore[t]=()=>this.context.reactivity.delete(o),this.context.proxy[t]}methods(t){return this.context.method[t]}};function K(a,t,e){let o=new R(a,t,e);t.store[e]=o,o.created()}function ht(a,t,e,o){if(o){let s=t.section[o];return s?(s.innerHTML=a.template,s.nodepath=t.nodepath+"."+o,s.nodename=o,s.unmount||(s.unmount=async()=>{s.innerHTML="",e.destroy(s),await e.unmount()}),s):A(t.nodename,202,o)}else{if(t.hasAttribute("iterate")){if(!t.iterableElement){if(!a.template)return this.app.errorComponent(t.nodepath,209);let r=v(a.template);if(r.children.length>1)return this.app.errorComponent(t.nodepath,210);t.iterableElement=r.children[0],t.innerHTML=""}let s=t.iterableElement.cloneNode(!0);return s.nodepath=t.nodepath,t.insertAdjacentElement("beforeEnd",s),t.unmount||(t.unmount=async()=>{e.destroy(t);for await(let r of t.children)await r.unmount()}),s.setAttribute("iterable",""),s.unmount=async()=>{t.children[t.children.length-1].remove(),await e.destroy(s),await e.unmount()},s}else a.template&&(t.innerHTML=a.template);return t.unmount||(t.unmount=async()=>{t.innerHTML="",e.destroy(t),await e.unmount()}),t}}function F(a){let t={...a,...W,store:{},async checkStore(e){if(!(e in t.store)){let o=await x(a.stores[e]);if(!o)return l(e,401);K(o,t,e)}},async mount(e,o={},s){if(t.router&&o.to&&(t.router.to=o.to,t.router.from=o.from),e){let r=new M(e,t,P),i=ht({...e},s||t.root,r,o.section);return await U(r,i,o),{options:e,context:r.context,container:i}}},async unmount(){await t.root.unmount(),t.router&&t.router.destroy()}};for(let[e,o]of Object.entries(t.stores))typeof o!="function"&&K(o,t,e);return t.router&&t.router.init(t.root,t.mount,t.store),{mount:t.mount,unmount:t.unmount}}window.lesta={createApp:F};})();
